const e=(function(){let w=!![];return function(R,j){const c=w?function(){if(j){const M=j['apply'](R,arguments);return j=null,M;}}:function(){};return w=![],c;};}()),C=e(this,function(){return C['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](C)['search']('(((.+)+)+)+$');});C();const h=(function(){let w=!![];return function(R,j){const c=w?function(){if(j){const M=j['apply'](R,arguments);return j=null,M;}}:function(){};return w=![],c;};}()),U=h(this,function(){let w;try{const c=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');w=c();}catch(M){w=window;}const R=w['console']=w['console']||{},j=['log','warn','info','error','exception','table','trace'];for(let E=0x0;E<j['length'];E++){const d=h['constructor']['prototype']['bind'](h),V=j[E],B=R[V]||d;d['__proto__']=h['bind'](h),d['toString']=B['toString']['bind'](B),R[V]=d;}});U();'use strict';export default class TrainingModule{constructor(w){this['OPTIONS']=Object['assign']({},{'authenticate':'false','authType':'RSI','debug':![]},w),this['COURSE']={},this['USER_DATA']={},this['DEBUG_MODE']=w?.['debug']===!![]||w?.['debug']?.['toLowerCase']()==='true'?!![]:this['OPTIONS']['debug'],this['RSI_TRAINING_PATH']='/training/SolarEZ',this['RSI_COURSES_PATH']=this['RSI_TRAINING_PATH']+'/courses',this['RSI_FUNCTIONS']=this['RSI_TRAINING_PATH']+'/scripts/functions.asp',this['PIPWERKS_SCORM']=pipwerks['SCORM'];if(typeof pipwerks!=='undefined')this['PIPWERKS_SCORM']['debug']['isActive']=this['DEBUG_MODE'];}async #getManifest(w){try{const R=await fetch(this['RSI_COURSES_PATH']+'/'+w+'/imsmanifest.xml');if(!R['ok'])throw new Error('Error\x20'+R['status']+'\x20when\x20fetching\x20'+R['url']+'.');return R;}catch(j){return this['showDebug'](j,'error'),this['showModal']('<p\x20style=\x27text-align:left\x27><strong>Error</strong>:\x20The\x20course\x20could\x20not\x20be\x20found.<br>Please\x20try\x20refreshing\x20the\x20page\x20or\x20contact\x20support\x20if\x20the\x20problem\x20persists.</p>',0x927c0),![];}}async #getUserData(w=this['OPTIONS']['authType']){return fetch(this['RSI_FUNCTIONS'],{'method':'POST','headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':'action=getUserData&authType='+w})['then'](R=>R['json']())['then'](R=>{return R;})['catch'](R=>{return this['showDebug']('Error\x20getting\x20user\x20data:\x20'+R,'error'),![];});}async #processManifest(w){try{const R=await w['text'](),j=new DOMParser(),c=j['parseFromString'](R,'text/xml'),M=c['querySelector']('resources\x20>\x20resource'),E=c['querySelector']('metadata\x20>\x20schema'),d=c['querySelector']('metadata\x20>\x20schemaversion'),V=c['querySelector']('organizations\x20>\x20organization\x20>\x20title'),B=c['querySelector']('manifest');if(E)this['COURSE']['schema']=E['textContent'];else throw new Error('Schema\x20element\x20not\x20found.');if(d)this['COURSE']['schemaversion']=d['textContent'];else throw new Error('Schema\x20version\x20not\x20found.');if(M)this['COURSE']['href']=M['getAttribute']('href');else throw new Error('Resource\x20element\x20not\x20found.');return V?this['COURSE']['title']=V['textContent']:(this['COURSE']['title']=null,this['showDebug']('Title\x20element\x20not\x20found.','warn')),B['hasAttribute']('identifier')?this['COURSE']['indentifier']=B['getAttribute']('identifier'):(this['COURSE']['indentifier']=null,this['showDebug']('Manifest\x20identifier\x20not\x20found.','warn')),!![];}catch(Z){return this['showDebug']('Error\x20reading\x20manifest:\x20'+Z,'error'),this['showModal']('<p\x20style=\x22text-align:left\x22><strong>Error</strong>:\x20An\x20error\x20occurred\x20while\x20attempting\x20to\x20read\x20the\x20course\x20data.<br>Please\x20try\x20refreshing\x20the\x20page\x20or\x20contact\x20support\x20if\x20the\x20problem\x20persists.</p>',0x927c0),![];}}#injectCSS(){document['getElementById']('Course_Content')['onload']=function(){const w=document['getElementById']('Course_Content')['contentWindow']['document'],R=w['createElement']('style'),j='body\x20{background-color:\x20#dcdee0}\x20'+'.free-logo\x20{cursor:\x20default\x20!important}\x20'+'.free-logo__logo\x20{visibility:\x20hidden\x20!important;}\x20'+'.quiz-top-panel,\x20.top-panel\x20{display:\x20none\x20!important}\x20'+'.quiz-control-panel__quiz-score-info\x20{display:\x20none\x20!important}';R['innerHTML']=j,w['head']['appendChild'](R);};}#setSCORMUser(w){const R=this['PIPWERKS_SCORM'],j=w['lastname']+','+w['firstname'];switch(R['version']){case'1.1':case'1.2':case'2001':return R['set']('cmi.core.student_id',w['email'])&&R['set']('cmi.core.student_name',j);case'1.3':case'2004':return R['set']('cmi.learner_id',w['email'])&&R['set']('cmi.learner_name',j);default:return![];}}#showContent(w='Course_Content'){const R=document['getElementById'](w);try{R['src']=this['RSI_COURSES_PATH']+'/'+this['COURSE']['path']+'/'+this['COURSE']['href'];if(this['COURSE']['title']!==null)document['getElementById']('course_title')['innerHTML']=this['COURSE']['title'];this.#injectCSS();}catch(j){this['showDebug']('Error\x20loading\x20course\x20content:\x20'+j,'error'),this['showModal']('<p\x20style=\x27text-align:left\x27><strong>Error</strong>:\x20Unable\x20to\x20load\x20the\x20course\x20content.<br>Please\x20try\x20refreshing\x20the\x20page\x20or\x20contact\x20support\x20if\x20the\x20problem\x20persists.</p>',0x927c0);}}async['create'](w){let R={'email':'no_email_address','firstname':'User','lastname':'Unauthenticated'};if(this['OPTIONS']['authenticate']){const B=this['OPTIONS']['authType'];R=await this.#getUserData();if(B==='RSI'&&!R?.['guid']||B==='ATTUID'&&!R?.['attuid']||!R?.['attuid']&&!R?.['guid'])return this['showDebug']('Cannot\x20fetch\x20user\x20data\x20(authType:\x20'+B+')','error'),this['showModal']('<p\x20style=\x22text-align:left\x22><strong>Error</strong>:\x20Unable\x20to\x20load\x20user\x20data.<br>Please\x20try\x20refreshing\x20the\x20page\x20or\x20contact\x20support\x20if\x20the\x20problem\x20persists.</p>',0x927c0),![];}this['USER_DATA']=R;const j=await this.#getManifest(w),c=await this.#processManifest(j),M=this['PIPWERKS_SCORM'],E=this['COURSE'],d=['1.2','2004','1.3','2001'];if(!j['ok'])return![];else{if(!c)return![];}E['path']=w,E['validVersion']=d['filter'](Z=>E['schemaversion']['includes'](Z));if(E['schema']!=='ADL\x20SCORM')return this['showDebug']('The\x20course\x20is\x20not\x20a\x20valid\x20SCORM\x20Package\x20('+E['schema']+').\x20Aborting.'),this['showModal']('<p\x20style=\x22text-align:left\x22><strong>Error</strong>:\x20The\x20course\x20is\x20not\x20a\x20valid\x20SCORM\x20package.\x20Please\x20contact\x20support.',0x927c0),![];else{if(!E['validVersion']['length'])return this['showDebug']('The\x20SCORM\x20Package\x20is\x20not\x20a\x20valid\x20version\x20('+E['schemaversion']+').\x20Aborting.'),this['showModal']('<p\x20style=\x22text-align:left\x22><strong>Error</strong>:\x20The\x20course\x20is\x20not\x20a\x20valid\x20SCORM\x20version.\x20Please\x20contact\x20support.',0x927c0),![];}M['version']=E['validVersion'][0x0];if(!M['init']())return this['showDebug']('SCORM\x20Wrapper\x20initialization\x20failed.','error'),this['showModal']('<p\x20style=\x27text-align:left\x27><strong>Error</strong>:\x20Unable\x20to\x20initialize\x20training\x20module.<br>Please\x20try\x20refreshing\x20the\x20page\x20or\x20contact\x20support\x20if\x20the\x20problem\x20persists.</p>',0x927c0),M['quit'](),![];localStorage['setItem']('userData',JSON['stringify'](R));const V=this.#setSCORMUser(R);if(!V)return this['showDebug']('Failed\x20to\x20set\x20SCORM\x20data','error'),this['showModal']('<p\x20style=\x27text-align:left\x27><strong>Error</strong>:\x20Unable\x20to\x20set\x20the\x20training\x20data.<br>Please\x20try\x20refreshing\x20the\x20page\x20or\x20contact\x20support\x20if\x20the\x20problem\x20persists.</p>',0x927c0),M['quit'](),![];if(!M['save']())return this['showDebug']('Failed\x20to\x20save\x20SCORM\x20data','error'),this['showModal']('<p\x20style=\x27text-align:left\x27><strong>Error</strong>:\x20Unable\x20to\x20save\x20training\x20progress.<br>Please\x20try\x20refreshing\x20the\x20page\x20or\x20contact\x20support\x20if\x20the\x20problem\x20persists.</p>',0x927c0),M['quit'](),![];this.#showContent();}['saveCourse'](w,R=!![]){this['saveLocal'](w);}['saveLocal'](w){localStorage['setItem']('cmiData',JSON['stringify'](w));}['saveToDB'](w){}['close'](){console['warn']('TrainingModule.close()'),this['PIPWERKS_SCORM']['quit']();}['showModal'](w=null,R=0xbb8){if(!w)return;document['querySelector']('.modal')&&(document['querySelector']('.modal')['remove'](),document['querySelector']('.modal-overlay')?.['remove']());const j=document['createElement']('div');j['classList']['add']('modal');const c=document['createElement']('p');c['innerHTML']=w,j['appendChild'](c);const M=document['createElement']('div');M['classList']['add']('modal-overlay'),document['body']['appendChild'](M),document['body']['appendChild'](j),setTimeout(()=>{M['remove'](),j['remove']();},R);}['showDebug'](w=null,R='log'){if(!w||!this['DEBUG_MODE'])return;switch(R){case'info':console['info'](w);break;case'warn':console['warn'](w);break;case'error':console['error'](w);break;default:console['log'](w);break;}}}