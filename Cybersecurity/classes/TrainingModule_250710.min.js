const F=(function(){let p=!![];return function(m,w){const J=p?function(){if(w){const g=w['apply'](m,arguments);return w=null,g;}}:function(){};return p=![],J;};}()),j=F(this,function(){return j['toString']()['search']('(((.+)+)+)+$')['toString']()['constructor'](j)['search']('(((.+)+)+)+$');});j();const y=(function(){let p=!![];return function(m,w){const J=p?function(){if(w){const g=w['apply'](m,arguments);return w=null,g;}}:function(){};return p=![],J;};}()),h=y(this,function(){const p=function(){let g;try{g=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(W){g=window;}return g;},m=p(),w=m['console']=m['console']||{},J=['log','warn','info','error','exception','table','trace'];for(let g=0x0;g<J['length'];g++){const W=y['constructor']['prototype']['bind'](y),Q=J[g],D=w[Q]||W;W['__proto__']=y['bind'](y),W['toString']=D['toString']['bind'](D),w[Q]=W;}});h();'use strict';export default class TrainingModule{constructor(p){this['OPTIONS']=Object['assign']({},{'authenticate':![],'authType':'RSI','debug':!![]},p),this['COURSE']={},this['USER_DATA']={},this['DEBUG_MODE']=p?.['debug']===!![]||typeof p?.['debug']==='string'&&p['debug']['toLowerCase']()==='true'||this['OPTIONS']['debug'],this['RSI_TRAINING_PATH']='/training/cybersecurity',this['RSI_COURSES_PATH']=this['RSI_TRAINING_PATH']+'/courses',this['RSI_FUNCTIONS']=this['RSI_TRAINING_PATH']+'/scripts/functions.asp',this['PIPWERKS_SCORM']=pipwerks['SCORM'],typeof pipwerks!=='undefined'&&(this['PIPWERKS_SCORM']['debug']['isActive']=this['DEBUG_MODE']);}async #getManifest(p){try{const m=await fetch(this['RSI_COURSES_PATH']+'/'+p+'/imsmanifest.xml');if(!m['ok'])throw new Error('Error\x20'+m['status']+'\x20when\x20fetching\x20'+m['url']+'.');return m;}catch(w){return this['showDebug'](w,'error'),this['showModal']('<p\x20style=\x27text-align:left\x27><strong>Error</strong>:\x20The\x20course\x20could\x20not\x20be\x20found.<br>Please\x20try\x20refreshing\x20the\x20page\x20or\x20contact\x20support\x20if\x20the\x20problem\x20persists.</p>',0x927c0),![];}}async #getUserData(p=this['OPTIONS']['authType']){return fetch(this['RSI_FUNCTIONS'],{'method':'POST','headers':{'Content-Type':'application/x-www-form-urlencoded'},'body':'action=getUserData&authType='+p})['then'](m=>m['json']())['then'](m=>m)['catch'](m=>{return this['showDebug']('Error\x20getting\x20user\x20data:\x20'+m,'error'),![];});}async #processManifest(p){try{const m=await p['text'](),w=new DOMParser(),J=w['parseFromString'](m,'text/xml'),g=J['querySelector']('resources\x20>\x20resource'),W=J['querySelector']('metadata\x20>\x20schema'),Q=J['querySelector']('metadata\x20>\x20schemaversion'),D=J['querySelector']('organizations\x20>\x20organization\x20>\x20title'),A=J['querySelector']('manifest');if(W)this['COURSE']['schema']=W['textContent'];else throw new Error('Schema\x20element\x20not\x20found.');if(Q)this['COURSE']['schemaversion']=Q['textContent'];else throw new Error('Schema\x20version\x20not\x20found.');if(g)this['COURSE']['href']=g['getAttribute']('href');else throw new Error('Resource\x20element\x20not\x20found.');if(D)this['COURSE']['title']=D['textContent'];else this['COURSE']['title']=null,this['showDebug']('Title\x20element\x20not\x20found.','warn');if(A['hasAttribute']('identifier'))this['COURSE']['indentifier']=A['getAttribute']('identifier');else this['COURSE']['indentifier']=null,this['showDebug']('Manifest\x20identifier\x20not\x20found.','warn');return!![];}catch(q){return this['showDebug']('Error\x20reading\x20manifest:\x20'+q,'error'),this['showModal']('<p\x20style=\x22text-align:left\x22><strong>Error</strong>:\x20An\x20error\x20occurred\x20while\x20attempting\x20to\x20read\x20the\x20course\x20data.<br>Please\x20try\x20refreshing\x20the\x20page\x20or\x20contact\x20support\x20if\x20the\x20problem\x20persists.</p>',0x927c0),![];}}#injectCSS(){document['getElementById']('Course_Content')['onload']=function(){const p=document['getElementById']('Course_Content')['contentWindow']['document'],m=p['createElement']('style');m['innerHTML']='body\x20{background-color:\x20#dcdee0}\x20'+'.free-logo\x20{cursor:\x20default\x20!important}\x20'+'.free-logo__logo\x20{visibility:\x20hidden\x20!important;}\x20'+'.quiz-top-panel,\x20.top-panel\x20{display:\x20none\x20!important}\x20'+'.quiz-control-panel__quiz-score-info\x20{display:\x20none\x20!important}',p['head']['appendChild'](m);};}#setSCORMUser(p){const m=this['PIPWERKS_SCORM'],w=p['lastname']+','+p['firstname'];switch(m['version']){case'1.1':case'1.2':case'2001':return m['set']('cmi.core.student_id',p['email'])&&m['set']('cmi.core.student_name',w);case'1.3':case'2004':return m['set']('cmi.learner_id',p['email'])&&m['set']('cmi.learner_name',w);default:return![];}}#showContent(p='Course_Content'){const m=document['getElementById'](p);try{m['src']=this['RSI_COURSES_PATH']+'/'+this['COURSE']['path']+'/'+this['COURSE']['href'];if(this['COURSE']['title']!==null)document['getElementById']('course_title')['innerHTML']=this['COURSE']['title'];this.#injectCSS();}catch(w){this['showDebug']('Error\x20loading\x20course\x20content:\x20'+w,'error'),this['showModal']('<p\x20style=\x27text-align:left\x27><strong>Error</strong>:\x20Unable\x20to\x20load\x20the\x20course\x20content.<br>Please\x20try\x20refreshing\x20the\x20page\x20or\x20contact\x20support\x20if\x20the\x20problem\x20persists.</p>',0x927c0);}}async['create'](p){let m={'email':'no_email_address','firstname':'User','lastname':'Unauthenticated'};m=await this.#getUserData(),this['USER_DATA']=m;const w=await this.#getManifest(p);if(!w?.['ok'])return![];const J=await this.#processManifest(w);if(!J)return![];const g=this['PIPWERKS_SCORM'],W=this['COURSE'],Q=['1.2','2004','1.3','2001'];W['path']=p,W['validVersion']=Q['filter'](A=>W['schemaversion']['includes'](A));if(W['schema']!=='ADL\x20SCORM')return this['showDebug']('The\x20course\x20is\x20not\x20a\x20valid\x20SCORM\x20Package\x20('+W['schema']+').\x20Aborting.'),this['showModal']('<p\x20style=\x22text-align:left\x22><strong>Error</strong>:\x20The\x20course\x20is\x20not\x20a\x20valid\x20SCORM\x20package.\x20Please\x20contact\x20support.',0x927c0),![];if(!W['validVersion']['length'])return this['showDebug']('The\x20SCORM\x20Package\x20is\x20not\x20a\x20valid\x20version\x20('+W['schemaversion']+').\x20Aborting.'),this['showModal']('<p\x20style=\x22text-align:left\x22><strong>Error</strong>:\x20The\x20course\x20is\x20not\x20a\x20valid\x20SCORM\x20version.\x20Please\x20contact\x20support.',0x927c0),![];g['version']=W['validVersion'][0x0];if(!g['init']())return this['showDebug']('SCORM\x20Wrapper\x20initialization\x20failed.','error'),this['showModal']('<p\x20style=\x27text-align:left\x27><strong>Error</strong>:\x20Unable\x20to\x20initialize\x20training\x20module.<br>Please\x20try\x20refreshing\x20the\x20page\x20or\x20contact\x20support\x20if\x20the\x20problem\x20persists.</p>',0x927c0),g['quit'](),![];localStorage['setItem']('userData',JSON['stringify'](m));const D=this.#setSCORMUser(m);if(!D)return this['showDebug']('Failed\x20to\x20set\x20SCORM\x20data','error'),this['showModal']('<p\x20style=\x27text-align:left\x27><strong>Error</strong>:\x20Unable\x20to\x20set\x20the\x20training\x20data.<br>Please\x20try\x20refreshing\x20the\x20page\x20or\x20contact\x20support\x20if\x20the\x20problem\x20persists.</p>',0x927c0),g['quit'](),![];if(!g['save']())return this['showDebug']('Failed\x20to\x20save\x20SCORM\x20data','error'),this['showModal']('<p\x20style=\x27text-align:left\x27><strong>Error</strong>:\x20Unable\x20to\x20save\x20training\x20progress.<br>Please\x20try\x20refreshing\x20the\x20page\x20or\x20contact\x20support\x20if\x20the\x20problem\x20persists.</p>',0x927c0),g['quit'](),![];this.#showContent();}['saveCourse'](p,m=!![]){this['saveLocal'](p);}['saveLocal'](p){localStorage['setItem']('cmiData',JSON['stringify'](p));}['saveToDB'](p){}['close'](){console['warn']('TrainingModule.close()'),this['PIPWERKS_SCORM']['quit']();}['showModal'](m=null,w=0xbb8){if(!m)return;document['querySelector']('.modal')?.['remove'](),document['querySelector']('.modal-overlay')?.['remove']();const J=document['createElement']('div');J['classList']['add']('modal');const g=document['createElement']('p');g['innerHTML']=m,J['appendChild'](g);const W=document['createElement']('div');W['classList']['add']('modal-overlay'),document['body']['appendChild'](W),document['body']['appendChild'](J),setTimeout(()=>{W['remove'](),J['remove']();},w);}['showDebug'](p=null,m='log'){if(!p||!this['DEBUG_MODE'])return;console[m](p);}}